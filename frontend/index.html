<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DigiLocker Auth Prototype</title>
</head>
<body>

<h2>DigiLocker Authentication (Prototype)</h2>

<div id="step1">
  <p>Step 1: Enter Details</p>
  <input id="phone" placeholder="Phone Number" /><br /><br />
  <input id="aadhaar" placeholder="Aadhaar Last 4 Digits" /><br /><br />
  <button onclick="startAuth()">Start Authentication</button>
</div>

<div id="step2" style="display:none;">
  <p>Step 2: Enter OTP</p>
  <input id="otp" placeholder="OTP" /><br /><br />
  <button onclick="verifyOtp()">Verify OTP</button>
</div>

<p id="result"></p>

<script>
async function startAuth() {
  const phone = document.getElementById("phone").value;
  const aadhaarLast4 = document.getElementById("aadhaar").value;

  const res = await fetch("http://localhost:3000/auth/start", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone, aadhaarLast4 })
  });

  const data = await res.json();

  if (data.status === "OTP_SENT") {
    document.getElementById("step2").style.display = "block";
    document.getElementById("result").innerText =
      "OTP sent (check server console)";
  } else {
    document.getElementById("result").innerText = "Invalid details";
  }
}

async function verifyOtp() {
  const phone = document.getElementById("phone").value;
  const otp = document.getElementById("otp").value;

  const res = await fetch("http://localhost:3000/auth/verify", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone, otp })
  });

  const data = await res.json();

  if (data.allowed === true) {
    document.getElementById("result").innerText = "✅ Allowed to vote";
    // handoff point for your friend's voting page
    // window.location.href = "/vote.html";
  } else {
    document.getElementById("result").innerText = "❌ Access denied";
  }
}
</script>

</body>
</html>
